<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="src/styles/index.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <!-- Modal Component -->
    <link rel="stylesheet" href="src/components/modals/modal.css" />
    <link rel="stylesheet" href="src/styles/accionModal.css">
    <script src="./src/components/modals/modal.js"></script>
    <script type="module" src="./src/components/modals/accionModal.js"></script>
    <!-- Toast Component -->
    <link rel="stylesheet" href="./src/components/toast/toast.css" />
    <script src="./src/components/toast/toast.js"></script>
    
    <!-- âœ… VOLVER a cargar Countries Service como script normal -->
    <script src="./src/services/countriesService.js"></script>

    <!-- Modal registro de usuarios -->
    <link rel="stylesheet" href="src/components/modals/registroUsuarios.css">
    <script src="src/components/modals/registroUsuarios.js"></script>
    
    <!-- Estilos existentes... -->
    <style>
      .btn-test {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-size: 0.9em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
      }
      .btn-test:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      }
      .btn-test:active {
        transform: translateY(0);
      }
    </style>
    <title>Monopoly</title>
  </head>
  <body>
    <!-- Tu HTML existente -->
    <div class="video-background">
      <video autoplay muted loop class="background-video">
        <source src="./public/assets/img/video.mp4" type="video/mp4">
        Tu navegador no soporta videos HTML5.
      </video>
      <div class="video-overlay"></div>
    </div>

    <div class="main-container">
      <div class="monopoly-logo-container">
        <img src="./public/assets/img/Monopoly-Emblem.webp" alt="Monopoly" class="monopoly-logo-img">
      </div>
      <div id="jugadores"></div>
      
      <div class="button-row-1">
        <button id="agregarBtn" class="btn-agregar">Agregar jugador</button>
      </div>
      
      <div class="button-row-2">
        <button class="btn-secundario" onclick="location.href='src/pages/como-jugar.html'">
          CÃ³mo jugar
        </button>
        <button class="btn-principal" onclick="guardarJugadores()">
          <div class="btn-content">
            <div class="btn-text">JUGAR</div>
            <div class="btn-emoji">ğŸ®</div>
          </div>
        </button>
        <button class="btn-ranking" onclick="location.href='src/pages/ranking.html'">
          ğŸ† Ranking
        </button>
      </div>
    </div>
    
    <!-- âœ… ELIMINAR el script de mÃ³dulo problemÃ¡tico -->
    <!-- 
    <script type="module">
        import { countriesService, getCountries } from './src/services/countriesService.js';
        window.countriesService = countriesService;
        window.getCountries = getCountries;
        console.log('âœ… Countries Service loaded as module');
    </script>
    -->
    
    <!-- âœ… AGREGAR script que crea el objeto countriesService globalmente -->
    <script>
        // Crear objeto countriesService usando las funciones ya cargadas
        if (typeof getCountries !== 'undefined' && typeof obtenerPaisesComoObjeto !== 'undefined') {
            window.countriesService = {
                obtenerPaises: getCountries,
                obtenerPaisesComoObjeto: obtenerPaisesComoObjeto,
                getCountries: getCountries,
                // Agregar funciÃ³n de obtener nombre de paÃ­s
                obtenerNombrePais: async function(codigo) {
                    try {
                        const paisesObj = await this.obtenerPaisesComoObjeto();
                        return paisesObj[codigo.toLowerCase()] || codigo.toUpperCase();
                    } catch (error) {
                        console.error(`Error obteniendo paÃ­s ${codigo}:`, error);
                        return codigo.toUpperCase();
                    }
                }
            };
            console.log('âœ… Countries Service object created globally');
        } else {
            console.warn('âš ï¸ Countries Service functions not found, creating minimal service');
            window.countriesService = {
                obtenerPaises: async () => [],
                obtenerPaisesComoObjeto: async () => ({}),
                obtenerNombrePais: async (codigo) => codigo.toUpperCase(),
                getCountries: async () => []
            };
        }
    </script>
    
    <!-- âœ… Scripts de mÃ³dulos -->
    <script type="module" src="./src/main.js"></script>
    <script type="module" src="./src/pages/index.js" defer></script>
    
    <!-- âœ… FUNCIÃ“N DE DEBUG COMPLETA -->
    <script>
        // âœ… FUNCIÃ“N DE DEBUGGING RÃPIDO
        window.debugEstado = function() {
            console.log('ğŸ” ESTADO COMPLETO DEL SISTEMA:');
            console.log('='.repeat(50));
            console.log('ğŸ‘¤ window.jugadores:', window.jugadores);
            console.log('ğŸ® window.indexController exists:', !!window.indexController);
            
            if (window.indexController) {
                console.log('ğŸ“Š indexController.jugadores:', window.indexController.jugadores);
                console.log('ğŸ”¢ indexController.contador:', window.indexController.contador);
            }
            
            console.log('ğŸ’¾ localStorage jugadores:', JSON.parse(localStorage.getItem('jugadores') || '[]'));
            console.log('ğŸ·ï¸ Jugador cards en DOM:', document.querySelectorAll('.jugador-card').length);
            console.log('='.repeat(50));
        };
        
        console.log('ğŸ’¡ Usa debugEstado() para ver el estado completo');
    </script>
    <script>
// âœ… FUNCIÃ“N DE DEBUG PARA FICHAS
window.debugFichas = function() {
    console.log('=== DEBUG FICHAS ===');
    
    // 1. Verificar controllers
    console.log('tableroController:', !!window.tableroController);
    console.log('gameController:', !!window.gameController);
    
    // 2. Verificar jugadores en ambos controllers
    if (window.tableroController) {
        console.log('tableroController.jugadores:', window.tableroController.jugadores);
    }
    
    if (window.gameController) {
        console.log('gameController.jugadores:', window.gameController.jugadores);
    }
    
    // 3. Verificar fichas en el DOM
    const fichas = document.querySelectorAll('.ficha-jugador');
    console.log('Fichas en DOM:', fichas.length);
    fichas.forEach((ficha, i) => {
        console.log(`Ficha ${i}:`, ficha.textContent, ficha.parentElement);
    });
    
    // 4. Verificar casillas con data-position
    const casillas = document.querySelectorAll('[data-position]');
    console.log('Casillas con data-position:', casillas.length);
    
    // 5. Test manual de fichas
    if (window.tableroController && window.gameController) {
        console.log('ğŸ§ª Probando actualizaciÃ³n manual de fichas...');
        window.tableroController.actualizarFichasPublico(
            window.gameController.jugadores, 
            window.gameController.turnoActual
        );
    }
};

// Ejecutar debug automÃ¡ticamente despuÃ©s de 3 segundos
setTimeout(() => {
    if (window.location.pathname.includes('tablero')) { // â† Solo funciona en tablero.html
        console.log('ğŸ” Ejecutando debug automÃ¡tico de fichas...');
        window.debugFichas();
    }
}, 3000);
</script>
  </body>
</html>